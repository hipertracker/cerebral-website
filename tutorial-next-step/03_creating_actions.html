<!DOCTYPE html><html class="ua_js_no"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Cerebral</title><script>(function(e,c){e[c]=e[c].replace(/(ua_js_)no/g,"$1yes");})(document.documentElement,"className");</script><link rel="stylesheet" href="../css/styles.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:700,500,400"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"/><link rel="shortcut icon" href="../favicon.ico"/><meta name="viewport" content="width=device-width,maximum-scale=1,initial-scale=1,user-scalable=no"/><meta name="format-detection" content="telephone=no"/><link name="apple-mobile-web-app-capable" content="yes"/></head><body class="page page_layout_tutorial-next-step"><div class="page__header"><div class="head-nav"><a class="link link__control head-nav__home i-bem" data-bem='{"link":{}}' role="link" href="../">Cerebral</a></div></div><div class="page__content"><div class="row"><div class="row__col row__col_sw_24 row__col_lw_5"><div class="side-nav"><div class="menu menu_theme_islands menu_size_xl menu_mode_radio menu__control i-bem" data-bem='{"menu":{}}' role="menu" tabindex="0"><div class="menu__group" role="group" aria-labelledby="uniq1469598834820121"><div class="menu__group-title" role="presentation" id="uniq1469598834820121">Tutorial: Introduction</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-introduction/01_introduction"}}' role="menuitemradio" id="uniq1469598834820122" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-introduction/01_introduction.html">Introduction</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-introduction/02_structuring_state"}}' role="menuitemradio" id="uniq1469598834820123" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-introduction/02_structuring_state.html">Structuring state</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-introduction/03_defining_signals"}}' role="menuitemradio" id="uniq1469598834820124" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-introduction/03_defining_signals.html">Signals and actions</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-introduction/04_creating_components"}}' role="menuitemradio" id="uniq1469598834820125" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-introduction/04_creating_components.html">Creating components</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1469598834820126"><div class="menu__group-title" role="presentation" id="uniq1469598834820126">Tutorial: Next step</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-next-step/01_next_step"}}' role="menuitemradio" id="uniq1469598834820127" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-next-step/01_next_step.html">Next step</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-next-step/02_adding_modules"}}' role="menuitemradio" id="uniq1469598834820128" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-next-step/02_adding_modules.html">Adding modules</a></div><div class="menu-item menu-item_type_link menu-item_checked menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-next-step/03_creating_actions"}}' role="menuitemradio" id="uniq1469598834820129" aria-checked="true"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-next-step/03_creating_actions.html">Creating actions</a></div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"tutorial-next-step/04_adding_shared_module"}}' role="menuitemradio" id="uniq1469598834820130" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../tutorial-next-step/04_adding_shared_module.html">Adding a shared module</a></div></div><div class="menu__group" role="group" aria-labelledby="uniq1469598834820131"><div class="menu__group-title" role="presentation" id="uniq1469598834820131">Get started</div><div class="menu-item menu-item_type_link menu-item_theme_islands i-bem" data-bem='{"menu-item":{"val":"get-started/get-started"}}' role="menuitemradio" id="uniq1469598834820132" aria-checked="false"><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" href="../get-started/get-started.html">Get started</a></div></div></div></div></div><div class="row__col row__col_sw_24 row__col_lw_18 row__col_lo_1"><div class="page__edit"><a class="link link_theme_islands link__control i-bem" data-bem='{"link":{}}' role="link" href="https://github.com/cerebral/cerebral-website/edit/v3/content/tutorial-next-step/03_creating_actions.en.md">Edit on GitHub</a></div><h2 class="heading heading_lvl_2" id="creating-actions">Creating actions</h2>
<p class="paragraph">Signals in Cerebral executes actions. Actions are just a function that receives a context:</p>
<pre><code class="code" class="lang-javascript">function myAction(context) { ... }
</code></pre>
<p class="paragraph">This context is created by Cerebral using its <strong>context providers</strong>. There are several kinds of context providers and you can also create your own. By default Cerebral will create four properties on this context:</p>
<pre><code class="code" class="lang-javascript">function myAction({input, state, output, services}) {

}
</code></pre>
<ul class="list">
<li class="list__item"><strong>input</strong> represents the initial payload (object) passed into the signal. Any outputs from an action will be merged and passed as input to the next action</li>
<li class="list__item"><strong>state</strong> has methods for changing and getting the state of your application</li>
<li class="list__item"><strong>output</strong> can pass a payload (object) that will be merged with the current input, allowing the next action(s) to use it. Asynchronous actions requires you to call an output to move on to the next action</li>
<li class="list__item"><strong>services</strong> allows you to do side effects like HTTP and other things. Use of services is also tracked and presented by the debugger</li>
</ul>
<h3 class="heading heading_lvl_3" id="changing-state">Changing state</h3>
<p class="paragraph">In the demo application we are using an operator to copy the <strong>title</strong> value from the input into our model:</p>
<p class="paragraph"><div><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" tabindex="0" href="https://github.com/cerebral/cerebral-website-tutorial-next/blob/react/src/modules/App/chains/changeNewItemTitle.js">src/modules/App/chains/changeNewItemTitle.js</a></div><code class="code" class="lang-js"><span class="token keyword" >import</span> <span class="token punctuation" >{</span>copy<span class="token punctuation" >}</span> <span class="token keyword" >from</span> <span class="token string" >'cerebral/operators'</span>

<span class="token keyword" >export</span> <span class="token keyword" >default</span> <span class="token punctuation" >[</span>
  <span class="token function" >copy</span><span class="token punctuation" >(</span><span class="token string" >'input:title'</span><span class="token punctuation" >,</span> <span class="token string" >'state:app.newItemTitle'</span><span class="token punctuation" >)</span>
<span class="token punctuation" >]</span>
</code></p>
<p class="paragraph">Cerebral includes some helpers to change the state of your application directly in a chain. These helpers are called <strong>operators</strong> and <strong>copy</strong> is one of these operators. We use the concept of a factory, a function that returns a function, to dynamically create an action. In this case we create an action that puts a value from the input into our model. You can also create these &quot;action factories&quot;, but let us first look at an example of a normal action:</p>
<p class="paragraph"><div><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" tabindex="0" href="https://github.com/cerebral/cerebral-website-tutorial-next/blob/react/src/modules/App/actions/addItem.js">src/modules/App/actions/addItem.js</a></div><code class="code" class="lang-js"><span class="token keyword" >function</span> <span class="token function" >addItem</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>state<span class="token punctuation" >}</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  state<span class="token punctuation" >.</span><span class="token function" >unshift</span><span class="token punctuation" >(</span><span class="token string" >'app.items'</span><span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    title<span class="token punctuation" >:</span> state<span class="token punctuation" >.</span><span class="token keyword" >get</span><span class="token punctuation" >(</span><span class="token string" >'app.newItemTitle'</span><span class="token punctuation" >)</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >export</span> <span class="token keyword" >default</span> addItem
</code></p>
<p class="paragraph">Here we are using the <strong>state</strong> API of Cerebral to put our a new item at the top of our items list. Since our title is already in the model we can just grab that. To use this action simply reference it in a chain, like we do here:</p>
<p class="paragraph"><div><a class="link link__control i-bem" data-bem='{"link":{}}' role="link" tabindex="0" href="https://github.com/cerebral/cerebral-website-tutorial-next/blob/react/src/modules/App/chains/submitNewItemTitle.js">src/modules/App/chains/submitNewItemTitle.js</a></div><code class="code" class="lang-js"><span class="token keyword" >import</span> <span class="token punctuation" >{</span><span class="token keyword" >set</span><span class="token punctuation" >}</span> <span class="token keyword" >from</span> <span class="token string" >'cerebral/operators'</span>
<span class="token keyword" >import</span> addItem <span class="token keyword" >from</span> <span class="token string" >'../actions/addItem.js'</span>
<span class="token keyword" >import</span> postItem <span class="token keyword" >from</span> <span class="token string" >'../actions/postItem.js'</span>
<span class="token keyword" >import</span> removeFailedItem <span class="token keyword" >from</span> <span class="token string" >'../actions/removeFailedItem.js'</span>
<span class="token keyword" >import</span> updateItem <span class="token keyword" >from</span> <span class="token string" >'../actions/updateItem.js'</span>

<span class="token keyword" >export</span> <span class="token keyword" >default</span> <span class="token punctuation" >[</span>
  <span class="token comment" spellcheck="true">// First we optimistically add the item</span>
  <span class="token comment" spellcheck="true">// to the items list</span>
  addItem<span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// We empty out the input</span>
  <span class="token keyword" >set</span><span class="token punctuation" >(</span><span class="token string" >'state:app.newItemTitle'</span><span class="token punctuation" >,</span> <span class="token string" >''</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// We set the app is saving mode to</span>
  <span class="token comment" spellcheck="true">// disable the input</span>
  <span class="token keyword" >set</span><span class="token punctuation" >(</span><span class="token string" >'state:app.isSaving'</span><span class="token punctuation" >,</span> <span class="token boolean" >true</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// We reset the error</span>
  <span class="token keyword" >set</span><span class="token punctuation" >(</span><span class="token string" >'state:app.error'</span><span class="token punctuation" >,</span> <span class="token keyword" >null</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// We post the item to the server</span>
  postItem<span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    success<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token comment" spellcheck="true">// We merge in the ID returned</span>
      <span class="token comment" spellcheck="true">// from the server</span>
      updateItem
    <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
    error<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token comment" spellcheck="true">// We remove the item since it</span>
      <span class="token comment" spellcheck="true">// failed</span>
      removeFailedItem<span class="token punctuation" >,</span>
      <span class="token comment" spellcheck="true">// We set an error to display</span>
      <span class="token keyword" >set</span><span class="token punctuation" >(</span><span class="token string" >'state:app.error'</span><span class="token punctuation" >,</span> <span class="token string" >'Adding item failed on server, removing it'</span><span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token comment" spellcheck="true">// The app goes back into normal state,</span>
  <span class="token comment" spellcheck="true">// enabling the input again</span>
  <span class="token keyword" >set</span><span class="token punctuation" >(</span><span class="token string" >'state:app.isSaving'</span><span class="token punctuation" >,</span> <span class="token boolean" >false</span><span class="token punctuation" >)</span>
<span class="token punctuation" >]</span>
</code></p>
<p class="paragraph">Adding an item to our list and save it to the server might seem like a simple thing to do, but as you can see there are quite a bit happening. And this is not Cerebral complexity, this is application complexity. What we want is:</p>
<ol class="list list_type_ordered">
<li class="list__item">Optimistically add our item to the list</li>
<li class="list__item">Reset the title in our new item input</li>
<li class="list__item">Disable the input by setting our application in a saving state</li>
<li class="list__item">Post item to the server</li>
<li class="list__item">If the server returns success we want to merge an ID into our optimistically added item</li>
<li class="list__item">If the server returns an error we want to remove our optimistically added item</li>
<li class="list__item">No matter what the server returns, we want to put our application back from saving state, which enables the input again</li>
</ol>
<p class="paragraph">As you can see this way of thinking is very much reflected in the chain above. That is why we often say that signals executes a decision tree, or a behaviour tree. It works very much like we think. This makes it easier to create a mental image of how these complex flows run.</p>
<h4 class="heading heading_lvl_4" id="best-practices">Best practices</h4>
<p class="paragraph">You have now gotten insight into how you can define your actions from scratch. When developing applications you will depend heavily on the <strong>operators</strong> to avoid creating new actions for every little state change. You will also start to create your own action factories and even chain factories to be reused in different signals. You will be surprised how quickly Cerebral becomes more like describing behaviour with legoblocks, rather than implementing logic.</p>
<p class="paragraph">Since chains are declarative, meaning that they do not have implementation logic, it is possible to describe them without thinking implementation. With your team or colleague you can talk about what should happen in your application when a signal triggers. Sometimes you can use <strong>operators</strong> to describe it, other times you just name an action that you will implement later. But most importantly a chain description will make it very easy for &quot;the next developer&quot;, that also being you, to build a mental image of what is going on.</p>
<h4 class="heading heading_lvl_4" id="challenge">Challenge</h4>
<p class="paragraph">Give new items an <strong>$isNew</strong> property which defaults to a true value. Use the operator <strong>delay</strong> in the <strong>success</strong> path and change the <strong>$isNew</strong> property of the first item in the list to <em>false</em> after 10 seconds. Then use this property in the UI to indicate when the item is new. Note that <strong>delay</strong> means that the signal will hold, so you will probably need to figure out where the <em>isSaving</em> should run.</p>

</div></div><div class="row row_sar"><div class="row__col row__col_sw_8"><div class="next"><a class="link link_theme_islands link_size_xl link__control i-bem" data-bem='{"link":{}}' role="link" href="./04_adding_shared_module.html"><div class="next__label">Next</div><div class="next__title">Adding a shared module</div></a></div></div></div></div><footer class="footer page__footer"><div class="row"><div class="row__col row__col_sw_24 row__col_lw_6"><h4 class="footer__header">ORGANIZATION</h4><a class="link link__control footer__link i-bem" data-bem='{"link":{}}' role="link" href="../contributors">Contributors</a></div><div class="row__col row__col_sw_24 row__col_lw_6 row__col_lo_3"><h4 class="footer__header">ARTICLES AND USEFUL LINKS</h4></div><div class="row__col row__col_sw_24 row__col_lw_6 row__col_lo_6"><h4 class="footer__header">HELP</h4></div></div></footer><script src="../js/scripts.min.js"></script></body></html>